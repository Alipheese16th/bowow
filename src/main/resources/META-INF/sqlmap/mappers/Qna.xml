<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.lec.bowow.dao.QnaDao">
	<resultMap type="Qna" id="QnaResult">
		<result property="qnaNum" column="qnaNum"/>
		<result property="memberId" column="memberId"/>
		<result property="productCode" column="productCode"/>
		<result property="qnaTitle" column="qnaTitle"/>
		<result property="qnaContent" column="qnaContent"/>
		<result property="qnaImage" column="qnaImage"/>
		<result property="qnaDate" column="qnaDate"/>
		<result property="qnaGroup" column="qnaGroup"/>
		<result property="qnaStep" column="qnaStep"/>
		<result property="qnaIndent" column="qnaIndent"/>
		<result property="qnaIp" column="qnaIp"/>
	</resultMap>
	<select id="qnaList" parameterType="Qna" resultMap="QnaResult">
		SELECT * FROM (SELECT ROWNUM RN, A.* FROM (SELECT * FROM QNA ORDER BY qnaNum) A)
			WHERE RN BETWEEN #{startRow} AND #{endRow}
	</select>
	<select id="totCntQna" resultType="int">
		SELECT COUNT(*) FROM QNA
	</select>
	<insert id="writeQna" parameterType="Qna">
		INSERT INTO QNA (qnaNum, memberId, productCode, qnaTitle, qnaContent, qnaImage, qnaGroup, qnaStep, qnaIndent, qnaIp)
    		VALUES (QNA_SEQ.NEXTVAL, #{memberId}, #{productCode}, #{qnaTitle}, #{qnaContent}, #{qnaImage}, QNA_SEQ.CURRVAL, 0, 0 , #{qnaIp});
	</insert>
	<select id="contentQna" parameterType="int" resultType="Qna">
		SELECT * FROM QNA WHERE qnaNum = #{qnaNum}
	</select>
	<update id="modifyQna" parameterType="Qna">
		UPDATE QNA SET qnaTitle = #{qnaTitle},
				qnaContent = #{qnaContent}
			WHERE qnaNum = #{qnaNum}
	</update>
	<delete id="deleteQna" parameterType="int">
		DELETE FROM QNA WHERE qnaNum = #{qnaNum}
	</delete>
	<update id="preReplyQna" parameterType="Qna">
		UPDATE QNA SET qnaStep = qnaStep + 1
    		WHERE qnaGroup = #{qnaGroup} AND qnaStep > #{qnaStep}
	</update>
	<insert id="replyQna" parameterType="Qna">
		INSERT INTO QNA (qnaNum, memberId, productCode, qnaTitle, qnaContent, qnaImage, qnaGroup, qnaStep, qnaIndent, qnaIp)
    		VALUES (QNA_SEQ.NEXTVAL, #{memberId}, #{productCode}, #{qnaTitle}, #{qnaContent}, #{qnaImage}, #{qnaGroup}, #{qnaStep}+1, #{qnaIndent}+1, #{qnaIp})
	</insert>
</mapper>